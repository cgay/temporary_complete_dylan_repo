<html>
<head>
  <title>Dylan Server Pages Documentation</title>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<body text="#000000" bgcolor="#F0F0FF">

<h1 align="center">Dylan Server Pages Documentation</h1>

<h2>Contents</h2>

<ol>
  <li><a href="#general-overview">Overview</a></li>
  <li><a href="#content-authoring">DSP Content Authoring</a></li>
    <ol>
      <li><a href="#content-overview">Overview (file names, exporting, format, passing tag args, ...)</a></li>
      <li><a href="#dsp-directives">DSP Directives</a></li>
      <li><a href="#dsp-taglib">The &quot;dsp&quot; Tag Library</a></li>
    </ol>
  <li><a href="#dsp-programming">DSP Programming</a></li>
    <ol>
      <li><a href="#programming-overview">Overview  (pointer to Koala doc for sessions, exporting, query args, requests, responses, page life cycle, etc)</a></li>
      <li><a href="#page-classes">Page Classes</a></li>
      <li><a href="#taglibs">Tag Libraries</a></li>
      <li><a href="#tags">Tags</a></li>
      <li><a href="#http-methods">Handling HTTP Methods (GET, POST, HEAD)</a></li>
      <li><a href="#forwarding-requests">Forwarding/Redirecting Requests</a></li>
      <li><a href="#named-methods">Named Methods</a></li>
    </ol>
  <li>Example</li>
</ol>

<a name="general-overview"></a>
<h2>Overview of DSP</h2>

<p>Dylan Server Pages (DSP) is a template engine for providing dynamic
web site content using the Dylan language.  They are similar in spirit
to JavaServer Pages, but without the ability to mix program logic and
page content, which everyone agrees is a bad idea anyway.  All dynamic
content is invoked via DSP tag calls such as
&lt;xx:show-current-username/&gt;.

<p>Currently, a DSP application is implemented as a Dylan project that
uses the Koala HTTP server library.  This effectively means that each
DSP application has to run on a different Koala server and therefore on
a different HTTP port.  (The plan is to eventually fix Koala to load DSP
application libraries at runtime, based on configuration files, or
better, to implement mod_dylan for Apache.)


<a name="content-authoring"></a>
<h2>Content Authoring</h2>

<a name="content-overview"></a>
<h3>Authoring Overview</h3>

<p>DSP templates contain normal HTML plus DSP tag calls.  DSP tag calls
generate the dynamic content of you web pages.  They use standard XML
syntax.  For example, &lt;mylib:mytag arg="foo"/&gt; is tag call with no
body that passes one argument, arg, to mytag when it is invoked.
&quot;mylib&quot; tells the DSP template engine what tag library (taglib
for short) &quot;mytag&quot; will be found in.

<p>There are several special tags called <a href="#dsp-directives">
directives</a> defined that couldn't easily have been defined by the
user.  DSP directives use the same syntax as other tags, but they use
the special tag library name <strong>%dsp</strong>.  For example, the <a
href="#include"><strong>include</strong></a> directive might look like
this: &lt;%dsp:include url=&quot;foo.dsp&quot;/&gt;.

<p> Each top-level template file must have a corresponding instance
of &lt;dylan-server-page&gt; associated with it.  This is accomplished
with the <strong>define page</strong> macro, which also publishes the
URLs associated with the page.

<p>DSP template files may have any filename extension, but the extension
&quot;.dsp&quot; may be treated specially in the future.  For example,
.dsp files may eventually be automatically exported as
&lt;dylan-server-page&gt;s.

<a name="dsp-directives"></a>
<h3>DSP Directives</h3>

<p>A DSP <strong>directive</strong> is used much like a normal DSP tag,
but it couldn't be written as a normal tag without special support from
the DSP engine. DSP directives are distinguished by the
<strong>%dsp</strong> tag prefix.  There are two built in DSP
directives:

<dl>
  <dt><strong>%dsp:include</strong></dt>
  <dd>Includes another DSP template (or plain HTML file) in the current page.
    Example usage:
      <pre>&lt;%dsp:include url="header.dsp"/&gt;</pre>

    Note that if the url given is absolute (i.e., begins with a slash) then the document
    is looked up relative to the document root directory.  Otherwise it is looked up
    relative to the directory containing the current document.
    <p>
  </dd>

  <dt><strong>%dsp:taglib</strong></dt>
  <dd>Declares another tag library to be in effect for the remainder of the page.  Taglib
    directives are cumulative.  That is, using two or more %dsp:taglib directives on
    the same page means that tags in either taglib may be used on that page.
    Example usage:
    <pre>
      &lt;%dsp:taglib name="my-taglib" prefix="xx"/&gt;
      ...
      &lt;xx:my-tag/&gt;
      ...
    </pre>
    <p>
  </dd>

</dl>

<a name="dsp-taglib"></a>
<h3>The &quot;dsp&quot; Tag Library</h3>

The &quot;dsp&quot; taglib defines a few tags that are generally useful
for any web application.

<dl>
  <a name="if"></a>
  <dt><strong>dsp:if</strong></dt>
  <dd>Conditionally includes its body content if a predicate returns true.  
    Example usage:
    <pre>
      &lt;dsp:if test="my-predicate?"&gt;
        &lt;dsp:then&gt;...true part...&lt;/dsp:then&gt;
        &lt;dsp:else&gt;...false part...&lt;/dsp:else&gt;
      &lt;/dsp:if&gt;
    </pre>
    Note that there may be multiple <strong>dsp:then</strong> and
    <strong>dsp:else</strong> tags inside the same
    <strong>dsp:if</strong> tag body.  If there is any plain HTML in the
    body of the <strong>dsp:if</strong>, and outside of any
    <strong>dsp:then</strong> or <strong>dsp:else</strong> tags, it will
    always be displayed.
    <p>
  </dd>

  <a name="then"></a>
  <dt><strong>dsp:then</strong></dt>
  <dd>
    Executes its body only if the test predicate of the containing dsp:if tag
    returned true.  When not contained in the body of a dsp:if tag its body
    will not be executed.<p>
  </dd>

  <a name="else"></a>
  <dt><strong>dsp:else</strong></dt>
  <dd>
    Executes its body only if the test predicate of the containing dsp:if tag
    returned false.  When not contained in the body of a dsp:if tag its body
    will not be executed.<p>
  </dd>

  <a name="table"></a>
  <dt><strong>dsp:table</strong></dt>
  <dd>
    TBD.  Haven't quite settled on a design here yet.<p>
  </dd>

  <a name="table-row-number"></a>
  <dt><strong>dsp:table-row-number</strong></dt>
  <dd>
    Displays the one-based number of the row currently being displayed.<p>
  </dd>

</dl>  


<a name="dsp-programming"></a>
<h2>DSP Programming</h2>

<a name="taglibs"></a>
<h3>Tag Libraries</h3>

Tags can be organized into separate tag libraries if needed (e.g., for
large web apps).  Each DSP page may use the <strong>%dsp:taglib</strong>
directive to specify which tag libraries are active for that page.  The
built-in &quot;dsp&quot; tag library is automatically available to all
DSP pages, without having to use the <strong>%dsp:taglib</strong>
directive to make it active.  The &quot;dsp&quot; taglib includes some
tags that are useful for almost all web pages.

<p>Taglibs are fairly uninteresting as far as programming a DSP
application goes.  They are only used when defining tags and
<strong>named methods</strong>, to specify which taglib those objects
belongs to.  They are defined as follows:
  <pre>
  define taglib demo ()
  end;
  </pre>

The above defines a taglib named &quot;demo&quot;.  See the <a
href="#tags">Tags</a> section for how the taglib is specified when
defining a tag.  This taglib would be included in a page with the
following directive:

  <pre>&lt;%dsp:taglib name="demo" prefix="xyz"/&gt;</pre>

and its tags would then be used like this:

  <pre>&lt;xyz:tag-one/&gt;</pre>


<a name="tags"></a>
<h3>Tags</h3>

Tags are defined with the "define tag" macro.  The syntax is:
  <pre>
    define tag tag-name [in taglib-name] (method-parameters) (tag-parameters)
      tag-body
    end;
  </pre>

The following example tag should clear things up a bit:
  <pre>
    define tag current-time in demo
        (page :: &lt;dylan-server-page&gt;, response :: &lt;response&gt;)
        (style)
      write(output-stream(response), current-time(style));
    end;
  </pre>

The above defines a tag called &quot;current-time&quot; in the
&quot;demo&quot; taglib which outputs the current time in the DSP page.
See <a href="#define-tag">the <strong>define tag</strong> macro</a> for
a full description tag definition.  The above tag would be called like
this:

  <pre>
    &lt;%dsp:taglib name="demo" prefix="xyz"/&gt;
    &lt;xyz:current-time style="24hr"/&gt;
  </pre>

Note that <code>style</code> defines a parameter for the tag call
such that the <code>style</code> variable is bound to the value of
that parameter in the body of the tag definition.

<p>The tag functon must always accept two arguments, <code>page</code>
and <code>response</code>.  The first argument will be an instance of
<code>&lt;dylan-server-page&gt;</code> and the second will be an
instance of <code>&lt;response&gt;</code>.


<h1>DSP Technical Reference</h1>

<span class="defname">define taglib</span> <span class="deftype">Macro</span>
<p>
<h3 class="defheader">Signature</h3>
<blockquote>
  define taglib <i>taglib-name</i> ()<br>
  end
</blockquote>

<h3 class="defheader">Summary</h3>
<blockquote>
  Defines a new tag library with name <i>taglib-name</i>.
</blockquote>

<hr>

<span class="defname">define tag</span> <span class="deftype">Macro</span>
<h3 class="defheader">Signature</h3>
<blockquote>
  define [<i>modifiers</i>] tag <i>tag-name</i> [in <i>taglib-name</i>]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;(<i>method-parameters</i>)<br>
  &nbsp;&nbsp;&nbsp;&nbsp;(<i>tag-call-parameters</i>)<br>
  &nbsp;&nbsp;<i>tag-body</i><br>
  end
</blockquote>

<h3 class="defheader">Summary</h3>
<blockquote>
  Defines a new tag named <i>tag-name</i> in the <i>taglib-name</i> tag library.
  If <i>taglib-name</i> isn't specified it defaults to &quot;dsp&quot;.
  <p>
  When the DSP engine invokes the tag it passes arguments that match <i>method-parameters</i>.
  
</blockquote>

<h3 class="defheader">Arguments</h3>

<table border="0" width="98%" align="center">
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The only valid modifier is <code>body</code>, which must be used if the tag is allowed to have a body.  If <code>body</code> is specified, <i>method-parameters</i> must have a third parameter (see below).
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>tag-name</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The name of the tag, as it will appear in the .dsp file.
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>taglib-name</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      The name of the taglib the tag should be added to.  If not specified, the &quot;dsp&quot; tag library will be used.
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>method-parameters</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
      Each tag definition creates a method that will be called when the tag is invoked.
      This is the parameter list for that method.  The basic form of the parameter list
      is (<i>page</i>, <i>response</i> [, <i>process-body</i>]).  <i>page</i>
      is an instance of <code>&lt;dylan-server-page&gt;</code>.  <i>response</i> is an
      instance of <code>&lt;response&gt;</code>.  <i>process-body</i> is an instance of
      <code>&lt;function&gt;</code>.  The <i>process-body</i> argument is optional, 

      <p>If the <code>body</code> modifier is not specified, the 
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
    </td>
  </tr>
  <tr><td width="100%" colspan="2"><i>modifiers</i></td></tr>
  <tr>
    <td width="2%">&nbsp;</td>
    <td width="98%">
    </td>
  </tr>
</table>

</body>
</html>

