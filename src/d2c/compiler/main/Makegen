
print <<'EOF';

MC = mindycomp
MINDYFLAGS =
MINDY = mindy

%.dbc: %.dylan
	$(MC) ${MINDYFLAGS} -lcompiler-main -o $@ $<


# Autodump divides object files into two types: Normal ones, and 
# ones derived from autodumped Dylan code.
#
NORMAL_OBJS = \
	main-exports.dbc \
	lexer.dbc \
	init.dbc \
	autodump.dbc \
	main.dbc

AUTODUMPED_OBJS = parse-dump.dbc token-dump.dbc

OBJS = ${NORMAL_OBJS} ${AUTODUMPED_OBJS}

LIBS = \
	../base/baselib.dbc \
	../front/frontlib.dbc \
	../parser/parserlib.dbc \
	../cback/cbacklib.dbc

d2c.dbc: ${LIBS} ${OBJS}
	cat  $^ > $@

d2c: d2c.dbc
	echo "#!/usr/local/bin/mindy -x" | cat - $^ > $@
	chmod +x $@

parse-dump.dylan: ../base/parse-tree.dylan autodump.dylan
	${MAKE} autodumper.dbc
	${MINDY} -f autodumper.dbc -autodump parse-tree

token-dump.dylan: ../base/tokens.dylan autodump.dylan
	${MAKE} autodumper.dbc
	${MINDY} -f autodumper.dbc -autodump tokens

autodumper.dbc: ${LIBS} ${NORMAL_OBJS}
	cat $^ > $@

EOF

push(@compile_dependencies, 'd2c.dbc');

do install ('bin', 'd2c');

push(@files_to_clean, 'd2c', '*.dbc', 'parse-dump.dylan', 'token-dump.dylan');
