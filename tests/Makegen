
$stage2 || ($D2C = 'mindy -f $(BUILDROOT)/compiler/main/d2c.dbc');
$D2CFLAGS = '-L../runtime/c-code -L../runtime/gc -L../runtime/dylan -L../runtime/streams -L../runtime/standard-io -L../runtime/print -L../runtime/format -L../runtime/random -L. -L../runtime/coll-ext -L../runtime/string-ext -L../runtime/table-ext -L../runtime/format-out -L../runtime/itime -L../runtime/regexp -L../runtime/matrix -L../runtime/time -L../runtime/melange';
$CPPFLAGS = '-I$(SRCROOT)/runtime';

do emit_library_rule(
    'dylan-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'regexp-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'stream-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'table-ext-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'random-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'matrix-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'coll-ext-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'print-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'format-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
do emit_library_rule(
    'format-out-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);
#do emit_library_rule(
#    'itime-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
#);
do emit_library_rule(
    'time-test', '$(BUILDROOT)/force.timestamp', '', 'compile'
);

# I only wrote this function because of the .\ for win32 vs. ./ for
# Unix issue.
sub emit_run_tests_rule {
    local (@tests) = @_;
    local ($test);
    print "run_tests : ";
    foreach $test (@tests) {
	print "$test$dot_exe ";
    }
    print "\n";

    foreach $test (@tests) {
	local ($test) = &convert_path_separator("./$test");
	print "\t$test\n";
    }
    push(@compile_dependencies, "run_tests");
}

do emit_run_tests_rule('dylan-test', 'regexp-test', 'stream-test', 
		       'table-ext-test', 'random-test', 'matrix-test', 
		       'coll-ext-test', 'print-test', 'format-test', 
		       'format-out-test');
# time-test removed because it is broken.
