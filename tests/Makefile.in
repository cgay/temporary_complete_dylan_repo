######################################################################
##
## Copyright (c) 1994  Carnegie Mellon University
## All rights reserved.
## 
## Use and copying of this software and preparation of derivative
## works based on this software are permitted, including commercial
## use, provided that the following conditions are observed:
## 
## 1. This copyright notice must be retained in full on any copies
##    and on appropriate parts of any derivative works.
## 2. Documentation (paper or online) accompanying any system that
##    incorporates this software, or any part of it, must acknowledge
##    the contribution of the Gwydion Project at Carnegie Mellon
##    University.
## 
## This software is made available "as is".  Neither the authors nor
## Carnegie Mellon University make any warranty about the software,
## its performance, or its conformity to any specification.
## 
## Bug reports, questions, comments, and suggestions should be sent by
## E-mail to the Internet address "gwydion-bugs@cs.cmu.edu".
##
######################################################################
##
##  $Header: /home/housel/work/rcs/gd/src/tests/Attic/Makefile.in,v 1.18 1997/02/19 13:31:22 nkramer Exp $
##
##  This is the makefile for the tautology test demo.
##

SHELL	=	/bin/sh

##
## begin autoconf'ed source
##

prefix	=		@prefix@
exec_prefix	=	@exec_prefix@
srcdir	=		@srcdir@

SRCDIR	=		${srcdir}
BINDIR	=		${exec_prefix}/bin
LIBDIR	=		${exec_prefix}/lib/mindy

CC	=		@CC@
CCOPTS	=		@CCOPTS@
CFLAGS	=		$(CCOPTS) -I${SRCDIR} @DEFS@ -DBINDIR=\"${BINDIR}\" -DLIBDIR=\"${LIBDIR}\"
YACC	=		@YACC@
YFLAGS	=		-d
LEX	=		@LEX@
LFLAGS	=		@LFLAGS@
RANLIB	=		@RANLIB@
INSTALL	=		@INSTALL@
INSTALL_PROGRAM	=	@INSTALL_PROGRAM@
INSTALL_DATA	=	@INSTALL_DATA@

LIBOBJS =		@LIBOBJS@
LIBS	=		@LIBS@

##
## end of configure written portion
##

MC	=	../comp/mindycomp
INTERP	=	../interp/mindy
MINDYFLAGS = 

# We put transcendental first in the path because if we don't, it'll
# go to look for the Transcendental library and instead find
# ../libraries/dylan/transcendental.dbc
#
MINDYPATH =   MINDYPATH=../libraries/transcendental:../libraries/dylan:../libraries/coll-ext:../libraries/table-ext:../libraries/string-ext:../libraries/standard-io:../libraries/streams:../libraries/random:../libraries/print:../libraries/format:../libraries/matrix::../libraries/format-out:../libraries/time:../libraries/regexp

# We don't want to run threaded-io-test by default because it is
# interactive. Time-test is not run because it won't work under any
# platform without dynamic library support in Mindy (such as Solaris)
#
OBJS_TO_RUN = dylan-test-lib.dbc regexp-test-lib.dbc stream-test-lib.dbc table-ext-test-lib.dbc random-test-lib.dbc matrix-test-lib.dbc coll-ext-test-lib.dbc print-test-lib.dbc format-test-lib.dbc format-out-test-lib.dbc

OBJS_TO_BUILD = $(OBJS_TO_RUN) threaded-io-test.dbc asterixes.txt dashes.txt

all: ${OBJS_TO_BUILD}
	for f in ${OBJS_TO_RUN}; do $(MINDYPATH) $(INTERP) -f $$f; done

threaded-io-test.dbc: ${SRCDIR}/threaded-io-test.dylan
	${MC} ${MINDYFLAGS} -lthreaded-io-test -o threaded-io-test.dbc ${SRCDIR}/threaded-io-test.dylan

dylan-test-lib.dbc: dylan-test-exports.dbc dylan-test.dbc
	cat dylan-test-exports.dbc dylan-test.dbc > $@
dylan-test-exports.dbc: ${SRCDIR}/dylan-test-exports.dylan
	${MC} ${MINDYFLAGS} -ldylan-test -o dylan-test-exports.dbc ${SRCDIR}/dylan-test-exports.dylan
dylan-test.dbc: ${SRCDIR}/dylan-test.dylan
	${MC} ${MINDYFLAGS} -ldylan-test -o dylan-test.dbc ${SRCDIR}/dylan-test.dylan

regexp-test-lib.dbc: regexp-test-exports.dbc regexp-test.dbc
	cat regexp-test-exports.dbc regexp-test.dbc > $@
regexp-test-exports.dbc: ${SRCDIR}/regexp-test-exports.dylan
	${MC} ${MINDYFLAGS} -lregexp-test -o regexp-test-exports.dbc ${SRCDIR}/regexp-test-exports.dylan
regexp-test.dbc: ${SRCDIR}/regexp-test.dylan
	${MC} ${MINDYFLAGS} -lregexp-test -o regexp-test.dbc ${SRCDIR}/regexp-test.dylan

stream-test-lib.dbc: stream-test-exports.dbc stream-test.dbc
	cat stream-test-exports.dbc stream-test.dbc > $@
stream-test-exports.dbc: ${SRCDIR}/stream-test-exports.dylan
	${MC} ${MINDYFLAGS} -lstream-test -o stream-test-exports.dbc ${SRCDIR}/stream-test-exports.dylan
stream-test.dbc: ${SRCDIR}/stream-test.dylan
	${MC} ${MINDYFLAGS} -lstream-test -o stream-test.dbc ${SRCDIR}/stream-test.dylan

table-ext-test-lib.dbc: table-ext-test-exports.dbc table-ext-test.dbc
	cat table-ext-test-exports.dbc table-ext-test.dbc > $@
table-ext-test-exports.dbc: ${SRCDIR}/table-ext-test-exports.dylan
	${MC} ${MINDYFLAGS} -ltable-ext-test -o table-ext-test-exports.dbc ${SRCDIR}/table-ext-test-exports.dylan
table-ext-test.dbc: ${SRCDIR}/table-ext-test.dylan
	${MC} ${MINDYFLAGS} -ltable-ext-test -o table-ext-test.dbc ${SRCDIR}/table-ext-test.dylan

random-test-lib.dbc: random-test-exports.dbc random-test.dbc
	cat random-test-exports.dbc random-test.dbc > $@
random-test-exports.dbc: ${SRCDIR}/random-test-exports.dylan
	${MC} ${MINDYFLAGS} -lrandom-test -o random-test-exports.dbc ${SRCDIR}/random-test-exports.dylan
random-test.dbc: ${SRCDIR}/random-test.dylan
	${MC} ${MINDYFLAGS} -lrandom-test -o random-test.dbc ${SRCDIR}/random-test.dylan

matrix-test-lib.dbc: matrix-test-exports.dbc matrix-test.dbc
	cat matrix-test-exports.dbc matrix-test.dbc > $@
matrix-test-exports.dbc: ${SRCDIR}/matrix-test-exports.dylan
	${MC} ${MINDYFLAGS} -lmatrix-test -o matrix-test-exports.dbc ${SRCDIR}/matrix-test-exports.dylan
matrix-test.dbc: ${SRCDIR}/matrix-test.dylan
	${MC} ${MINDYFLAGS} -lmatrix-test -o matrix-test.dbc ${SRCDIR}/matrix-test.dylan

coll-ext-test-lib.dbc: coll-ext-test-exports.dbc coll-ext-test.dbc
	cat coll-ext-test-exports.dbc coll-ext-test.dbc > $@
coll-ext-test-exports.dbc: ${SRCDIR}/coll-ext-test-exports.dylan
	${MC} ${MINDYFLAGS} -lcoll-ext-test -o coll-ext-test-exports.dbc ${SRCDIR}/coll-ext-test-exports.dylan
coll-ext-test.dbc: ${SRCDIR}/coll-ext-test.dylan
	${MC} ${MINDYFLAGS} -lcoll-ext-test -o coll-ext-test.dbc ${SRCDIR}/coll-ext-test.dylan

print-test-lib.dbc: print-test-exports.dbc print-test.dbc
	cat print-test-exports.dbc print-test.dbc > $@
print-test-exports.dbc: ${SRCDIR}/print-test-exports.dylan
	${MC} ${MINDYFLAGS} -lprint-test -o print-test-exports.dbc ${SRCDIR}/print-test-exports.dylan
print-test.dbc: ${SRCDIR}/print-test.dylan
	${MC} ${MINDYFLAGS} -lprint-test -o print-test.dbc ${SRCDIR}/print-test.dylan

format-test-lib.dbc: format-test-exports.dbc format-test.dbc
	cat format-test-exports.dbc format-test.dbc > $@
format-test-exports.dbc: ${SRCDIR}/format-test-exports.dylan
	${MC} ${MINDYFLAGS} -lformat-test -o format-test-exports.dbc ${SRCDIR}/format-test-exports.dylan
format-test.dbc: ${SRCDIR}/format-test.dylan
	${MC} ${MINDYFLAGS} -lformat-test -o format-test.dbc ${SRCDIR}/format-test.dylan

format-out-test-lib.dbc: format-out-test-exports.dbc format-out-test.dbc
	cat format-out-test-exports.dbc format-out-test.dbc > $@
format-out-test-exports.dbc: ${SRCDIR}/format-out-test-exports.dylan
	${MC} ${MINDYFLAGS} -lformat-out-test -o format-out-test-exports.dbc ${SRCDIR}/format-out-test-exports.dylan
format-out-test.dbc: ${SRCDIR}/format-out-test.dylan
	${MC} ${MINDYFLAGS} -lformat-out-test -o format-out-test.dbc ${SRCDIR}/format-out-test.dylan

# We no longer need rules for itime-test-lib (since we abandoned the
# library), but it doesn't hurt to leave this here
itime-test-lib.dbc: itime-test-exports.dbc itime-test.dbc
	cat itime-test-exports.dbc itime-test.dbc > $@
itime-test-exports.dbc: ${SRCDIR}/itime-test-exports.dylan
	${MC} ${MINDYFLAGS} -litime-test -o itime-test-exports.dbc ${SRCDIR}/itime-test-exports.dylan
itime-test.dbc: ${SRCDIR}/itime-test.dylan
	${MC} ${MINDYFLAGS} -litime-test -o itime-test.dbc ${SRCDIR}/itime-test.dylan

time-test-lib.dbc: time-test-exports.dbc time-test.dbc
	cat time-test-exports.dbc time-test.dbc > $@
time-test-exports.dbc: ${SRCDIR}/time-test-exports.dylan
	${MC} ${MINDYFLAGS} -ltime-test -o time-test-exports.dbc ${SRCDIR}/time-test-exports.dylan
time-test.dbc: ${SRCDIR}/time-test.dylan
	${MC} ${MINDYFLAGS} -ltime-test -o time-test.dbc ${SRCDIR}/time-test.dylan

# And now, two hacks to make sure "asterixes.txt" and "dashes.txt" are 
# in the build directory and not the source directory (while still
# handling the case that build-dir == src-dir)
#
asterixes.txt : ${SRCDIR}/asterixes.src
	cp ${SRCDIR}/asterixes.src ./asterixes.txt
dashes.txt : ${SRCDIR}/dashes.src
	cp ${SRCDIR}/dashes.src ./dashes.txt

clean:
	rm -f ${OBJS} *~ \#* *.dbc core

realclean:
	rm -f ${OBJS} Makefile *~ \#* core

install:
